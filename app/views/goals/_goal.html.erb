<%= javascript_include_tag "https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js", "https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.14/jquery-ui.min.js", "rails.js" %>
<style>
  .handle:hover{cursor: move;}

  #milestones { list-style-type: none; margin: 0; padding: 0; width: 60%; }
</style>

<tr>
  <td class="goal">
    <h1><%= goal.title %></h1>
    <p><%= goal.description %></p>
    <ul id="milestones"> <% goal.milestones.each do |milestone| %>
      <li id="milestone_<%= milestone.id %>">
        <span class="title"> <%= milestone.title %> </span><br>
        <span class="description"> <%= milestone.description %> </span>
      </li>
      <% end %>
    </ul>
      <% #= render :partial => 'milestones/milestone', :collection => goal.milestones%>
  </td>
</tr>

<% content_for :javascript do %>
  <% javascript_tag do %>
     $('#milestones').sortable(
        {
          axis: 'y',
          dropOnEmpty:false,
          cursor: 'crosshair',
          items: 'li',
          opacity: 0.4,
          scroll: true,
          update: function(){
            $.ajax({
                type: 'post',
                data: $('#milestones').sortable('serialize') + '&id=<%=@goal.id-%>',
                dataType: 'script',
                complete: function(request){
                    $('#milestones').effect('highlight');
                  },
                url: '/goals/prioritize_milestones'})
            }
          })
    <% end %>
<% end %>